<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/head :: headFragment"></head>

<body id="page-top">

<!-- Navigation-->
<th:block th:replace="fragments/menu"></th:block>

<!-- Page Content-->
<div class="container-fluid p-0">
    <section class="resume-section" id="about">
        <div class="resume-section-content">
            <!-- 게시글 양식 -->
                <div class="mb-5"><h3>게시글 제목</h3>
                    <div>
                        <input type="text" name="title" maxlength="50" th:value="${board.getTitle()}" readonly/>
                    </div>
                </div>

                <div class="mb-5"> <h3>게시글 내용</h3>
                    <div>
                        <input type="text" name="content" maxlength="50" th:value="${board.getContent()}" readonly/>
                    </div>
                </div>
            <!-- 댓글 작성 -->
            <form th:if="${#strings.equals(board.memberid,session.user?.id)}">
                <input type="hidden" id="boardid" th:value="${board.id}">
                <input type="hidden" id="memberid" th:value="|${session?.user.id}|">
                <textarea id="comment" rows="5"></textarea>
                <input th:type="button" th:onclick="submitComment()">댓글 작성</input>
            </form>

            <!-- 댓글 목록 -->
            <div class="d-flex flex-column flex-md-row justify-content-between">
                <ul id="comment-list">
                    <li th:each="comment : ${comments}">
                        <p th:text="${comment.content}"></p>
                    </li>
                </ul>
            </div>
        </div>
    </section>

</div>

<!-- common/js -->
<th:block th:replace="common/js :: jsFragment"><</th:block>
</body>
</html>

<!-- script -->
<script th:inline="javascript">
    function submitComment() {

        let boardid = $("#boardid").val();
        let memberid = $("#memberid").val();
        let comment = $("#comment").val();

        alert(boardid);
        alert(memberid);
        alert(comment);

        $.ajax({
            url: "/comments",
            method: "POST",
            contentType: 'application/json',
            data: JSON.stringify({
                board_id : boardid,
                memberid : memberid,
                content : comment
            }),
            success: function (response) {

                // 작성 완료 메시지 표시
                alert("댓글이 작성되었습니다.");
            },
            error: function () {
                alert("댓글 작성에 실패했습니다.");
            }
        });
    }


    function loadComments() {
        $.ajax({
            type: "GET",
            url: "/comments",
            success: function(comments) {
                // 댓글 목록 가져오기 성공 시 동작
                var template = $("#comment-template").html();
                var rendered = Mustache.render(template, {comments: comments});
                $("#comment-list").html(rendered);
            },
            error: function(error) {
                // 댓글 목록 가져오기 실패 시 동작
                $("#comment-list").html("댓글 목록을 불러오는데 실패하였습니다.");
            }
        });
    }


</script>